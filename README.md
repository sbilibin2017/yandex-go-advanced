

# Яндекс Практикум "Продвинутый Go Разработчик" 🚀  
## Сервис сбора метрик и алертинга 📊

## 📌 Описание проекта

Это система для сбора runtime-метрик, разработанная в рамках трека **«Сервис сбора метрик и алертинга»** курса **«Продвинутый Go-разработчик»** от Яндекс Практикума.  
Состоит из двух компонентов:

- **Сервер** — принимает и хранит метрики;
- **Агент** — собирает метрики из среды выполнения и отправляет их на сервер.

---

## ⚙️ Метрики

Поддерживаются два типа метрик:

- **gauge** (`float64`) — значение перезаписывается при каждом обновлении;
- **counter** (`int64`) — значение увеличивается на заданное при каждом обновлении.

---

## 🌐 Сервер

Сервер слушает `http://localhost:8080` и обрабатывает http запросы  

---

## 🛰 Агент

Агент предназначен для автоматического сбора метрик из стандартной библиотеки `runtime` и их периодической отправки на сервер.

### Что делает агент:

- Использует `runtime.ReadMemStats` для сбора метрик (`Alloc`, `TotalAlloc`, `Sys`, и др.);
- Обновляет значения `counter` метрик (например, количество попыток отправки);
- Отправляет данные на сервер с заданной периодичностью (`pollInterval`, `reportInterval`);
- Работает параллельно, используя `context.Context` и фоновые воркеры.

Агент можно запустить отдельно, указав адрес сервера и частоту опроса/отправки метрик через конфигурацию.

---

## 🏗 Структура проекта

Проект имеет слоистую архитектуру, взаимодействие слоев осуществляется с помощью интерфейсов.                                                                             


```
.
├── cmd                     // Входные точки приложений: агент и сервер
│   ├── agent               // Команда агента: флаги, запуск, инициализация
│   │   ├── flags.go            // Парсинг и обработка флагов командной строки агента
│   │   ├── main.go             // Точка входа агента — инициализация и запуск приложения
│   │   └── run.go              // Запуск и инициализация компонентов агента
│   └── server              // Команда сервера: флаги, запуск HTTP-сервера
│       ├── flags.go            // Парсинг и обработка флагов командной строки сервера
│       ├── main.go             // Точка входа сервера — инициализация и запуск HTTP-сервера
│       └── run.go              // Запуск и инициализация компонентов сервера
├── go.mod                  // Манифест Go-модуля, описание зависимостей
├── go.sum                  // Контрольные суммы зависимостей для обеспечения воспроизводимости сборки
├── internal                // Внутренние пакеты проекта (бизнес-логика, обработчики, конфиги и др.)
│   ├── apps                // Основные приложения: агент и сервер с бизнес-логикой
│   │   ├── agent.go           // Основная бизнес-логика приложения агента
│   │   ├── agent_test.go      // Тесты для приложения агента
│   │   ├── server.go          // Основная бизнес-логика приложения сервера
│   │   └── server_test.go     // Тесты для приложения сервера
│   ├── configs             // Конфигурации и параметры запуска агента и сервера
│   │   ├── agent.go           // Конфигурации и параметры запуска агента
│   │   ├── agent_test.go      // Тесты конфигураций агента
│   │   ├── server.go          // Конфигурации и параметры запуска сервера
│   │   └── server_test.go     // Тесты конфигураций сервера
│   ├── errors              // Обработка ошибок и определение типов ошибок
│   │   ├── common.go          // Общие ошибки и обработчики ошибок
│   │   └── metric.go          // Ошибки и обработка ошибок, связанные с метриками
│   ├── facades             // Фасады для упрощения взаимодействия с метриками
│   │   ├── metric.go          // Фасады для работы с метриками
│   │   └── metric_test.go     // Тесты фасадов метрик
│   ├── handlers            // HTTP-обработчики запросов (с моками и тестами)
│   │   ├── metric_get_path.go         // HTTP-обработчик получения метрики по пути
│   │   ├── metric_get_path_mock.go    // Мок для обработчика metric_get_path.go
│   │   ├── metric_get_path_test.go    // Тесты для обработчика metric_get_path.go
│   │   ├── metric_list_html.go        // HTTP-обработчик страницы списка метрик в HTML
│   │   ├── metric_list_html_mock.go   // Мок для обработчика metric_list_html.go
│   │   ├── metric_list_html_test.go   // Тесты для HTML-обработчика списка метрик
│   │   ├── metric_update_path.go      // HTTP-обработчик обновления метрик по пути
│   │   ├── metric_update_path_mock.go // Мок для обработчика metric_update_path.go
│   │   └── metric_update_path_test.go // Тесты для обработчика обновления метрик
│   ├── repositories       // Репозитории для хранения и получения данных (метрик)
│   │   ├── metric_memory_get.go       // Репозиторий получения метрик из памяти
│   │   ├── metric_memory_get_test.go  // Тесты для репозитория получения метрик
│   │   ├── metric_memory_list.go      // Репозиторий получения списка всех метрик из памяти
│   │   ├── metric_memory_list_test.go // Тесты для списка метрик
│   │   ├── metric_memory_save.go      // Репозиторий сохранения и обновления метрик в памяти
│   │   ├── metric_memory_save_test.go // Тесты сохранения метрик
│   │   └── metric_memory_storage.go   // Хранилище метрик в памяти с логикой доступа
│   ├── routers            // Определение HTTP-маршрутов API для работы с метриками
│   │   ├── metric.go          // HTTP-маршруты для метрик
│   │   └── metric_test.go     // Тесты маршрутов метрик
│   ├── runners            // Логика запуска приложений, управление контекстом и воркерами
│   │   ├── context.go         // Управление контекстом выполнения приложений
│   │   ├── context_test.go    // Тесты для управления контекстом
│   │   ├── server.go          // Запуск и управление HTTP-сервером
│   │   ├── server_mock.go     // Мок для серверного раннера
│   │   ├── server_test.go     // Тесты логики сервера
│   │   ├── worker.go          // Логика фоновых задач и воркеров
│   │   └── worker_test.go     // Тесты для воркеров
│   ├── services           // Сервисы для работы с метриками (получение, обновление, список)
│   │   ├── metric_get.go         // Сервис получения метрик по имени и типу
│   │   ├── metric_get_mock.go    // Мок сервиса получения метрик
│   │   ├── metric_get_test.go    // Тесты сервиса получения метрик
│   │   ├── metric_list.go        // Сервис получения списка всех метрик
│   │   ├── metric_list_mock.go   // Мок сервиса списка метрик
│   │   ├── metric_list_test.go   // Тесты сервиса списка метрик
│   │   ├── metric_update.go      // Сервис обновления значений метрик
│   │   ├── metric_update_mock.go // Мок сервиса обновления метрик
│   │   └── metric_update_test.go // Тесты сервиса обновления
│   ├── types              // Определения структур и типов данных для метрик
│   │   ├── metric.go         // Структуры и типы данных для метрик
│   │   └── metric_test.go    // Тесты для структур и типов метрик
│   ├── validators         // Валидация входных данных для метрик
│   │   ├── metric.go         // Валидация данных метрик
│   │   └── metric_test.go    // Тесты валидаторов метрик
│   └── workers            // Фоновые задачи и агенты по сбору и отправке метрик
│       ├── metric_agent.go       // Агент сбора и отправки метрик (фоновые задачи)
│       ├── metric_agent_mock.go  // Мок для агента сбора метрик
│       └── metric_agent_test.go  // Тесты агента сбора метрик
├── Makefile               // Скрипты для сборки, тестирования и запуска проекта
└── README.md              // Документация проекта: описание, установка, запуск, примеры
```

## 🛠 Используемые технологии

| Технология / Библиотека | Описание                            |
|-------------------------|-------------------------------------|
| Go                   | Язык программирования               |
| Chi                  | HTTP роутер                         |
| Sqlx                 | Драйвер БД (Postgres)               |
| Resty                | HTTP клиент                         |
| Testify              | Фреймворк для тестирования          |
| Docker               | Утилита для контейнеризации         |

---

## 🔄 Инкременты проекта

| Итерация | Описание                                               |
|----------|--------------------------------------------------------|
| iter1    | Реализация сервера метрик                              | 
| iter2    | Реализация агента метрик                               | 
| iter3    | Добавлены обработчики сервера для поулчения метрик     | 
| iter4    | Добавлены флаги для конфигурирования сервера, агента   | 
| iter5    | Добавлены переменные окружения для конфигурирования сервера, агента | 

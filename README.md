

# Яндекс Практикум "Продвинутый Go Разработчик" 🚀  
## Сервис сбора метрик и алертинга 📊

## 📌 Описание проекта

Это система для сбора runtime-метрик, разработанная в рамках трека **«Сервис сбора метрик и алертинга»** курса **«Продвинутый Go-разработчик»** от Яндекс Практикума.  
Состоит из двух компонентов:

- **Сервер** — принимает и хранит метрики;
- **Агент** — собирает метрики из среды выполнения и отправляет их на сервер.

---

## ⚙️ Метрики

Поддерживаются два типа метрик:

- **gauge** (`float64`) — значение перезаписывается при каждом обновлении;
- **counter** (`int64`) — значение увеличивается на заданное при каждом обновлении.

---

## 🌐 Сервер

Сервер слушает `http://localhost:8080` и обрабатывает http запросы  

---

## 🛰 Агент

Агент предназначен для автоматического сбора метрик из стандартной библиотеки `runtime` и их периодической отправки на сервер.

### Что делает агент:

- Использует `runtime.ReadMemStats` для сбора метрик (`Alloc`, `TotalAlloc`, `Sys`, и др.);
- Обновляет значения `counter` метрик (например, количество попыток отправки);
- Отправляет данные на сервер с заданной периодичностью (`pollInterval`, `reportInterval`);
- Работает параллельно, используя `context.Context` и фоновые воркеры.

Агент можно запустить отдельно, указав адрес сервера и частоту опроса/отправки метрик через конфигурацию.

---

## 🏗 Структура проекта

Проект имеет слоистую архитектуру, взаимодействие слоев осуществляется с помощью интерфейсов.                                                                             

```
.
├── cmd
│   ├── agent
│   │   ├── agent                          // Скомпилированный бинарный файл агента
│   │   ├── flags.go                       // Парсинг и хранение CLI-флагов агента
│   │   ├── flags_test.go                  // Тесты флагов агента
│   │   ├── main.go                        // Точка входа в приложение агента
│   │   ├── run.go                         // Запуск и логика инициализации агента
│   │   └── run_test.go                    // Тесты запуска агента
│   └── server
│       ├── flags.go                       // Парсинг и хранение CLI-флагов сервера
│       ├── flags_test.go                  // Тесты флагов сервера
│       ├── main.go                        // Точка входа в приложение сервера
│       ├── run.go                         // Запуск и логика инициализации сервера
│       ├── run_test.go                    // Тесты запуска сервера
│       └── server                         // Скомпилированный бинарный файл сервера
├── go.mod                                 // Описание модуля Go и зависимостей
├── go.sum                                 // Контрольные суммы зависимостей
├── internal
│   ├── apps
│   │   ├── agent.go                       // Основная логика работы агента
│   │   ├── agent_test.go                  // Тесты логики агента
│   │   ├── server.go                      // Основная логика работы сервера
│   │   └── server_test.go                 // Тесты логики сервера
│   ├── configs
│   │   ├── agent.go                       // Конфигурации и параметры агента
│   │   ├── agent_test.go                  // Тесты конфигурации агента
│   │   ├── server.go                      // Конфигурации и параметры сервера
│   │   └── server_test.go                 // Тесты конфигурации сервера
│   ├── errors
│   │   ├── common.go                      // Общие ошибки и утилиты
│   │   └── metric.go                      // Ошибки, связанные с метриками
│   ├── facades
│   │   ├── metric.go                      // Упрощённый интерфейс для работы с метриками
│   │   └── metric_test.go                 // Тесты фасада
│   ├── handlers
│   │   ├── metric_get_body.go             // POST /value с JSON: получение метрик
│   │   ├── metric_get_body_mock.go        // Моки для тестов metric_get_body
│   │   ├── metric_get_body_test.go        // Тесты получения метрик из тела запроса
│   │   ├── metric_get_path.go             // GET /value/{type}/{name}: получение метрик
│   │   ├── metric_get_path_mock.go        // Моки для тестов metric_get_path
│   │   ├── metric_get_path_test.go        // Тесты получения по пути
│   │   ├── metric_list_html.go            // HTML-страница со списком метрик
│   │   ├── metric_list_html_mock.go       // Моки для HTML-обработчика
│   │   ├── metric_list_html_test.go       // Тесты списка метрик в HTML
│   │   ├── metric_update_body.go          // POST /update с JSON: обновление метрик
│   │   ├── metric_update_body_mock.go     // Моки для обновления метрик
│   │   ├── metric_update_body_test.go     // Тесты обновления из тела
│   │   ├── metric_update_path.go          // POST /update/{type}/{name}/{value}
│   │   ├── metric_update_path_mock.go     // Моки для обновления по пути
│   │   └── metric_update_path_test.go     // Тесты обновления по пути
│   ├── logger
│   │   ├── logger.go                      // Инициализация логгера
│   │   └── logger_test.go                 // Тесты логгера
│   ├── middlewares
│   │   ├── logging.go                     // Middleware логирования HTTP-запросов
│   │   └── logging_test.go                // Тесты middleware логирования
│   ├── repositories
│   │   ├── metric_memory_get.go           // Получение метрик из памяти
│   │   ├── metric_memory_get_test.go      // Тесты получения метрик
│   │   ├── metric_memory_list.go          // Получение всех метрик из памяти
│   │   ├── metric_memory_list_test.go     // Тесты списка метрик
│   │   ├── metric_memory_save.go          // Сохранение/обновление метрик
│   │   ├── metric_memory_save_test.go     // Тесты сохранения метрик
│   │   └── metric_memory_storage.go       // Структура и реализация хранилища
│   ├── routers
│   │   ├── metric.go                      // Регистрация HTTP-маршрутов
│   │   └── metric_test.go                 // Тесты роутера
│   ├── runners
│   │   ├── run.go                         // Общий запуск приложений (агент/сервер)
│   │   ├── run_mock.go                    // Моки для тестирования run
│   │   └── run_test.go                    // Тесты логики запуска
│   ├── services
│   │   ├── metric_get.go                  // Сервис получения метрик
│   │   ├── metric_get_mock.go             // Моки для получения
│   │   ├── metric_get_test.go             // Тесты получения метрик
│   │   ├── metric_list.go                 // Сервис списка всех метрик
│   │   ├── metric_list_mock.go            // Моки списка
│   │   ├── metric_list_test.go            // Тесты списка метрик
│   │   ├── metric_update.go               // Сервис обновления метрик
│   │   ├── metric_update_mock.go          // Моки обновления
│   │   └── metric_update_test.go          // Тесты обновления метрик
│   ├── types
│   │   ├── metric.go                      // Структуры метрик (Gauge, Counter)
│   │   └── metric_test.go                 // Тесты типов метрик
│   ├── validators
│   │   ├── metric.go                      // Валидация входящих метрик
│   │   └── metric_test.go                 // Тесты валидации
│   └── workers
│       ├── metric_agent.go                // Фоновый сборщик и отправитель метрик
│       ├── metric_agent_mock.go           // Моки агента
│       └── metric_agent_test.go           // Тесты агента
├── Makefile                               // Скрипты сборки, тестов, линтинга
└── README.md                              // Документация проекта: запуск, описание API
```

## 🛠 Используемые технологии

| Технология / Библиотека | Описание                            |
|-------------------------|-------------------------------------|
| Go                   | Язык программирования               |
| Chi                  | HTTP роутер                         |
| Sqlx                 | Драйвер БД (Postgres)               |
| Zap                  | Логгер               |
| Resty                | HTTP клиент                         |
| Testify              | Фреймворк для тестирования          |
| Docker               | Утилита для контейнеризации         |

---

## 🔄 Инкременты проекта

| Итерация | Описание                                               |
|----------|--------------------------------------------------------|
| iter1    | Реализация сервера метрик                              | 
| iter2    | Реализация агента метрик                               | 
| iter3    | Добавлены обработчики сервера для поулчения метрик     | 
| iter4    | Добавлены флаги для конфигурирования сервера, агента   | 
| iter5    | Добавлены переменные окружения для конфигурирования сервера, агента | 
| iter6    | Добавлен логер и мидлвар для логирования запросов и ответов сервера | 
| iter7    | Добавлены обработчики сервера для получения и обновления метрик (в теле запроса)  метрик | 
| iter8    | Добавлен мидлвар для сжатия/разжатия запросов и ответов сервера | 
